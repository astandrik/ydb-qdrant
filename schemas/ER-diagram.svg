<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="741px" preserveAspectRatio="none" style="width:1268px;height:741px;background:#FFFFFF;" version="1.1" viewBox="0 0 1268 741" width="1268px" zoomAndPan="magnify"><title>Entity Relationship Diagram for YDB-Qdrant Service
(Physical Data Model - YDB Tables)</title><defs/><g><g class="title" data-source-line="12"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="410.7441" x="421.8804" y="22.9951">Entity Relationship Diagram for YDB-Qdrant Service</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="277.1563" x="488.6744" y="39.292">(Physical Data Model - YDB Tables)</text></g><!--class collections--><g class="entity" data-qualified-name="collections" data-source-line="14" id="ent0002"><rect fill="#E8F4F8" height="170.3438" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="517.3262" x="24.78" y="60.5938"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="108.3398" x="229.2732" y="76.7324">&#171;Metadata Table&#187;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.9932" x="227.4465" y="92.5576">qdr__collections</text><line style="stroke:#000000;stroke-width:0.5;" x1="25.78" x2="541.1062" y1="100.8594" y2="100.8594"/><g data-visibility-modifier="IE_MANDATORY"><ellipse cx="35.78" cy="114.5078" fill="#000000" rx="3" ry="3" style="stroke:#000000;stroke-width:1;"/></g><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="349.9521" x="44.78" y="117.8545">collection : Utf8 &#171;PK&#187;  // "&lt;tenant&gt;/&lt;collection&gt;"</text><line style="stroke:#000000;stroke-width:1;" x1="25.78" x2="541.1062" y1="125.1563" y2="125.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="505.3262" x="30.78" y="142.1514">table_name : Utf8          // always "qdrant_all_points" in one-table layout</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183.8594" x="30.78" y="158.4482">vector_dimension : Uint32</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="328.2686" x="30.78" y="174.7451">distance : Utf8 {Cosine|Euclid|Dot|Manhattan}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="179.5869" x="30.78" y="191.042">vector_type : Utf8 {float}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166.8994" x="30.78" y="207.3389">created_at : Timestamp</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="499.3857" x="30.78" y="223.6357">last_accessed_at : Timestamp  // updated on each operation (throttled)</text></g><!--class global_points--><g class="entity" data-qualified-name="global_points" data-source-line="25" id="ent0003"><rect fill="#E8F4F8" height="194.6406" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="552.8936" x="7" y="296.9838"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="130.084" x="218.4048" y="313.1224">&#171;Global Points Table&#187;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.8271" x="223.5332" y="328.9476">qdrant_all_points</text><line style="stroke:#000000;stroke-width:0.5;" x1="8" x2="558.8936" y1="337.2494" y2="337.2494"/><g data-visibility-modifier="IE_MANDATORY"><ellipse cx="18" cy="350.8978" fill="#000000" rx="3" ry="3" style="stroke:#000000;stroke-width:1;"/></g><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="441.3623" x="27" y="354.2445">uid : Utf8 &#171;PK&#187;        // derived from tenant + collection (uidFor)</text><g data-visibility-modifier="IE_MANDATORY"><ellipse cx="18" cy="367.1947" fill="#000000" rx="3" ry="3" style="stroke:#000000;stroke-width:1;"/></g><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137.874" x="27" y="370.5414">point_id : Utf8 &#171;PK&#187;</text><line style="stroke:#000000;stroke-width:1;" x1="8" x2="558.8936" y1="377.8431" y2="377.8431"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="329.1162" x="13" y="394.8382">embedding : String (binary, full-precision float)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="540.8936" x="13" y="411.1351">embedding_quantized : String (binary, bit-quantized for approximate search)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170.6797" x="13" y="427.432">payload : JsonDocument</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:1,2;" x1="8" x2="558.8936" y1="434.7338" y2="434.7338"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="142.249" x="13" y="451.7289">Auto-partitioning:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="219.3447" x="13" y="468.0257">partitioningByLoad = ENABLED</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="278.0313" x="13" y="484.3226">partitioningBySize = ENABLED (100MB)</text></g><g class="entity" data-qualified-name="GMN5" data-source-line="41" id="ent0006"><path d="M576.72,72.6638 L576.72,142.6638 L542.6,146.6638 L576.72,150.6638 L576.72,218.8591 A0,0 0 0 0 576.72,218.8591 L844.1678,218.8591 A0,0 0 0 0 844.1678,218.8591 L844.1678,82.6638 L834.1678,72.6638 L576.72,72.6638 A0,0 0 0 0 576.72,72.6638" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M834.1678,72.6638 L834.1678,82.6638 L844.1678,82.6638 L834.1678,72.6638" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151.9692" x="582.72" y="89.7306">Primary Key Format:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246.4478" x="582.72" y="104.8635">collection = "&lt;tenant&gt;/&lt;collection&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="582.72" y="119.9963">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="75.0991" x="582.72" y="135.1291">Examples:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.7446" x="582.72" y="150.2619">&#8226; "default/my_vectors"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.5986" x="582.72" y="165.3947">&#8226; "user123/embeddings"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="582.72" y="180.5275">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.4468" x="582.72" y="195.6603">Tenant/collection names are</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.0459" x="582.72" y="210.7931">sanitized to [a-z0-9_]</text></g><g class="entity" data-qualified-name="GMN8" data-source-line="53" id="ent0009"><path d="M595.38,290.9338 L595.38,390.6638 L560.26,394.6638 L595.38,398.6638 L595.38,497.6603 A0,0 0 0 0 595.38,497.6603 L1261.505,497.6603 A0,0 0 0 0 1261.505,497.6603 L1261.505,300.9338 L1251.505,290.9338 L595.38,290.9338 A0,0 0 0 0 595.38,290.9338" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1251.505,290.9338 L1251.505,300.9338 L1261.505,300.9338 L1251.505,290.9338" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115.8701" x="601.38" y="308.0006">uid Convention:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.5566" x="601.38" y="323.1335">uid = uidFor(tenant, collection)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="601.38" y="338.2663">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149.7158" x="601.38" y="353.3991">Embedding Storage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313.606" x="601.38" y="368.5319">&#8226; embedding: Binary string (FloatVector format)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370.1064" x="601.38" y="383.6647">&#8226; embedding_quantized: Binary string (BitVector format)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="601.38" y="398.7975">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="337.854" x="601.38" y="413.9303">Search Modes (YDB_QDRANT_SEARCH_MODE):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341.5166" x="601.38" y="429.0631">&#8226; exact (default): single-phase KNN over embedding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="645.125" x="601.38" y="444.196">&#8226; approximate: bit-quantized candidates from embedding_quantized + re-ranking over embedding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="601.38" y="459.3288">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.1255" x="601.38" y="474.4616">Serialization:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281.709" x="601.38" y="489.5944">&#8226; Client-side: pre-serialized binary (always)</text></g><!--link collections to global_points--><g class="link" data-entity-1="ent0002" data-entity-2="ent0003" data-link-type="crowfoot" data-source-line="38" id="lnk4"><path codeLine="38" d="M283.45,239.2938 C283.45,260.3638 283.45,257.0738 283.45,278.6538" fill="none" id="collections-global_points" style="stroke:#0000FF;stroke-width:1;"/><line style="stroke:#0000FF;stroke-width:1;" x1="279.45" x2="287.45" y1="235.2938" y2="235.2938"/><line style="stroke:#0000FF;stroke-width:1;" x1="279.45" x2="287.45" y1="238.2938" y2="238.2938"/><line style="stroke:#0000FF;stroke-width:1;" x1="283.45" x2="283.45" y1="239.2938" y2="231.2938"/><line style="stroke:#0000FF;stroke-width:1;" x1="283.45" x2="289.45" y1="288.6538" y2="296.6538"/><line style="stroke:#0000FF;stroke-width:1;" x1="283.45" x2="277.45" y1="288.6538" y2="296.6538"/><line style="stroke:#0000FF;stroke-width:1;" x1="283.45" x2="283.45" y1="288.6538" y2="296.6538"/><ellipse cx="283.45" cy="282.6538" fill="none" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260.1777" x="22.45" y="260.0406">groups points via uid (tenant/collection)</text></g><g class="legend" data-source-line="68"><rect fill="#DDDDDD" height="205.5625" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:1;" width="589.5918" x="652.9132" y="515.6603"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="91.875" x="657.9132" y="533.6554">Cardinality:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="579.5918" x="657.9132" y="549.9523">&#8226; One qdr__collections row &#8596; many rows in qdrant_all_points sharing the same uid</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="657.9132" y="566.2492">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="94.2061" x="657.9132" y="582.5461">Data Types:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.6924" x="657.9132" y="598.8429">&#8226; Utf8 = String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="256.8809" x="657.9132" y="615.1398">&#8226; String (binary) = Binary byte array</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="303.9531" x="657.9132" y="631.4367">&#8226; JsonDocument = Arbitrary JSON structure</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="283.7051" x="657.9132" y="647.7336">&#8226; Timestamp = DateTime with timezone</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="657.9132" y="664.0304">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="68.2979" x="657.9132" y="680.3273">Sources:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="339.3018" x="657.9132" y="696.6242">&#8226; PlantUML ER: https://plantuml.com/er-diagram</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="413.5811" x="657.9132" y="712.9211">&#8226; YDB Types: https://ydb.tech/docs/en/yql/reference/types/</text></g><!--SRC=[VLRRRkCs47tNLyowBtPs5MKl1L8Z2U3hBZQnuusT0aLR2BH4MyHIf49IJfHaWJxr2_e5_RJzaWufsLBiHVsGc9mvmvavS_6hcAwOeB3ezQz6ORytkFnuStqx7S9FezFnX_6fzwfIc5s-a8x7em_zdpqlOJ65YAc8Kqz_PI8ZYgJ04M6AZ89K9f4DGSI9rl3a0Nxw9FgwLZ8NyK1ogGvSA9MaYgag5VeS4UwsfvIytrxcrFlcUOOPJc4ay7y1DvGJmwJG2SjWoCZQlhr2xT-6VVzBh8WmCATgmoBwXsZFaaApY70O4aDW8cFAmRUgi21BJdN7ysXfjtKNgp2C9ESqSlPRG3Gqpd1sDg66nDQG0rzSk6YF6ahGXLkpEaNLsIMA8GYWTMQeGASkWhDQxwA5GD_7FyPQ2WL9wHQx-o2Oy7jIQESRcWW9vs4ccJ3e71CW1VKT7ZWfP6xGt0RjInN6BAL2LmwX_ljtA8kPDaH4kuUU1b8ZcS-ZFE8iVXvAypmX8Y46jRxLjXpPMyYAIsAiC5AK61g7nA1iWS-XxJH30LO1EXf5LEi3iOifpsABHE-1aYW1cL7b68MsIPGqo7NSiRGtYDaF7fbPSxaasnjC-4TtXbbvVabGpk9zPdOfnX9a6tHdfMGA9LNmkabf6z5ZgJhEadikt3Ut9PEcInh7JAnHF3VAVcalcI2gU0Ehd7C_KpHYZXUNo4uJ4zxb-3PxfF4Fq4jc_5fkovracP8FBCLSWgP4HOcrbf423LiBdxKKGndbM0YsC8xnOoCuwkL6-jYnc5lq0n_f7XqvO7tJBwwiZNCOJMtV3W_4S_IY5aFxxSd9fEyuQ_RByxFlowSzehhGieCXqr1TR1Xn_BJBt0UrXKxByuJ4y1HR9mRagjcDBfQPmlXL0PUq0AG8Sr46qs3l_7yQqDaOFM1XuYGeaT__-XTQE1P9pasG5c7P0xgr5UMQghVltWSxrdHbQB7lFTYUra0KjM9D12kvCn9-9_xZYVzB-2UMU0msnFr0N-JCkMbJD91YOvj2Yj9PUtSEPNbMwNlJYBsp2t5NbdCCXgnf7UikZYxqNQc1hYflR0lqLnU-hRUqhDONcBfY3z1zTeXrlinTgRf9hA6DWpZyChpfJHVXVDIx6NmA9zV3KQVXtmE93BGhHZfTm8crvjJF4g8fN4wd83TKrIvLi4PpTFTw9o8YPdO2wRBbVzH_hq5H7uVELnlBmGDL78eHpXv9JOTzUC0PCkHhN9rTm6xtTQM7LijUXdOvr3iDyZbTsuEZtraV48MF8SuKjUrhNDNxImfmMSBtl_-1b8Z27hHT30SJ4tH2734cmMbXbmrMpJOKjneNEEKRFU26starXggxbpEfW-AAz6M1jKkK8aMbsPmzgDPJI86ocf_drrDR8tbaSaKhxNezdDirJUqPxfb9mE2tHznokwJBN4LDDsSSuxoTNC7efWk9CPdk1a5cB_EK7qSo3QZou_97GWLnkzy5kmCKyVBOq2W9OXdfW8gWkEE1eYkgAAxBm2v07LYwIfx-0m00]--></g></svg>