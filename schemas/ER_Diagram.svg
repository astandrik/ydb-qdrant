<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="763px" preserveAspectRatio="none" style="width:1239px;height:763px;background:#FFFFFF;" version="1.1" viewBox="0 0 1239 763" width="1239px" zoomAndPan="magnify"><title>Entity Relationship Diagram for YDB-Qdrant Service
(Physical Data Model - YDB Tables)</title><defs/><g><g class="title" data-source-line="12"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="376.9063" x="424.293" y="23.5352">Entity Relationship Diagram for YDB-Qdrant Service</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="255.3223" x="485.085" y="40.0234">(Physical Data Model - YDB Tables)</text></g><!--class collections--><g class="entity" data-entity="collections" data-source-line="14" data-uid="ent0002" id="entity_collections"><rect fill="#E8F4F8" height="172.0391" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="506.9971" x="22.8" y="60.9766"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="101.7246" x="225.4362" y="77.5781">&#171;Metadata Table&#187;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.8945" x="221.3513" y="93.6445">qdr__collections</text><line style="stroke:#000000;stroke-width:0.5;" x1="23.8" x2="528.7971" y1="101.5977" y2="101.5977"/><ellipse cx="33.8" cy="115.3418" fill="#000000" rx="3" ry="3" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="342.6855" x="42.8" y="119.1328">collection : Utf8 &#171;PK&#187;  // "&lt;tenant&gt;/&lt;collection&gt;"</text><line style="stroke:#000000;stroke-width:1;" x1="23.8" x2="528.7971" y1="126.0859" y2="126.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="494.9971" x="28.8" y="143.6211">table_name : Utf8          // always "qdrant_all_points" in one-table layout</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="178.3359" x="28.8" y="160.1094">vector_dimension : Uint32</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="310.4951" x="28.8" y="176.5977">distance : Utf8 {Cosine|Euclid|Dot|Manhattan}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164.4658" x="28.8" y="193.0859">vector_type : Utf8 {float}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.291" x="28.8" y="209.5742">created_at : Timestamp</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="484.9141" x="28.8" y="226.0625">last_accessed_at : Timestamp  // updated on each operation (throttled)</text></g><!--class global_points--><g class="entity" data-entity="global_points" data-source-line="25" data-uid="ent0003" id="entity_global_points"><rect fill="#E8F4F8" height="196.5273" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="538.5928" x="7" y="306.9266"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="124.7754" x="213.9087" y="323.5281">&#171;Global Points Table&#187;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.3525" x="217.6201" y="339.5945">qdrant_all_points</text><line style="stroke:#000000;stroke-width:0.5;" x1="8" x2="544.5928" y1="347.5477" y2="347.5477"/><ellipse cx="18" cy="361.2918" fill="#000000" rx="3" ry="3" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="431.6416" x="27" y="365.0828">uid : Utf8 &#171;PK&#187;        // derived from tenant + collection (uidFor)</text><ellipse cx="18" cy="377.7801" fill="#000000" rx="3" ry="3" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.4443" x="27" y="381.5711">point_id : Utf8 &#171;PK&#187;</text><line style="stroke:#000000;stroke-width:1;" x1="8" x2="544.5928" y1="388.5242" y2="388.5242"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="321.7949" x="13" y="406.0594">embedding : String (binary, full-precision float)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="526.5928" x="13" y="422.5477">embedding_quantized : String (binary, bit-quantized for approximate search)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164.8555" x="13" y="439.0359">payload : JsonDocument</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:1,2;" x1="8" x2="544.5928" y1="445.9891" y2="445.9891"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="131.9609" x="13" y="463.5242">Auto-partitioning:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="208.7354" x="13" y="480.0125">partitioningByLoad = ENABLED</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="263.7441" x="13" y="496.5008">partitioningBySize = ENABLED (100MB)</text></g><g class="entity" data-entity="GMN5" data-source-line="41" data-uid="ent0006" id="entity_GMN5"><path d="M564.71,73.1066 L564.71,143.3666 L530.29,147.3666 L564.71,151.3666 L564.71,220.9015 A0,0 0 0 0 564.71,220.9015 L823.8868,220.9015 A0,0 0 0 0 823.8868,220.9015 L823.8868,83.1066 L813.8868,73.1066 L564.71,73.1066 A0,0 0 0 0 564.71,73.1066" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M813.8868,73.1066 L813.8868,83.1066 L823.8868,83.1066 L813.8868,73.1066" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="135.2495" x="570.71" y="90.6749">Primary Key Format:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238.1768" x="570.71" y="105.9855">collection = "&lt;tenant&gt;/&lt;collection&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="570.71" y="121.296">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66.7583" x="570.71" y="136.6066">Examples:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.854" x="570.71" y="151.9171">&#8226; "default/my_vectors"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.5742" x="570.71" y="167.2277">&#8226; "user123/embeddings"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="570.71" y="182.5382">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.4131" x="570.71" y="197.8488">Tenant/collection names are</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.2739" x="570.71" y="213.1593">sanitized to [a-z0-9_]</text></g><g class="entity" data-entity="GMN8" data-source-line="53" data-uid="ent0009" id="entity_GMN8"><path d="M580.11,293.0166 L580.11,401.3666 L545.76,405.3666 L580.11,409.3666 L580.11,517.3642 A0,0 0 0 0 580.11,517.3642 L1232.4923,517.3642 A0,0 0 0 0 1232.4923,517.3642 L1232.4923,303.0166 L1222.4923,293.0166 L580.11,293.0166 A0,0 0 0 0 580.11,293.0166" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1222.4923,293.0166 L1222.4923,303.0166 L1232.4923,303.0166 L1222.4923,293.0166" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="105.1807" x="586.11" y="310.5849">uid Convention:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.5488" x="586.11" y="325.8955">uid = uidFor(tenant, collection)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="586.11" y="341.206">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="133.4531" x="586.11" y="356.5166">Embedding Storage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="351.584" x="586.11" y="371.8271">&#8226; embedding: Binary string via Knn::ToBinaryStringFloat</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406.4214" x="586.11" y="387.1377">&#8226; embedding_quantized: Binary string via Knn::ToBinaryStringBit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="586.11" y="402.4482">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="308.3945" x="586.11" y="417.7587">Search Modes (YDB_QDRANT_SEARCH_MODE):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="330.9731" x="586.11" y="433.0693">&#8226; exact (default): single-phase KNN over embedding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="631.3823" x="586.11" y="448.3798">&#8226; approximate: bit-quantized candidates from embedding_quantized + re-ranking over embedding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="586.11" y="463.6904">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="86.1504" x="586.11" y="479.0009">Serialization:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326.8853" x="586.11" y="494.3115">&#8226; Server-side: Knn::ToBinaryStringFloat/Bit (default)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="570.1084" x="586.11" y="509.622">&#8226; Client-side: pre-serialized binary (YDB_QDRANT_CLIENT_SIDE_SERIALIZATION_ENABLED)</text></g><!--link collections to global_points--><g class="link" data-entity-1="collections" data-entity-2="global_points" data-source-line="38" data-uid="lnk4" id="link_collections_global_points"><path codeLine="38" d="M276.3,241.3366 C276.3,264.7866 276.3,264.3666 276.3,288.4566" fill="none" id="collections-global_points" style="stroke:#0000FF;stroke-width:1;"/><line style="stroke:#0000FF;stroke-width:1;" x1="272.3" x2="280.3" y1="237.3366" y2="237.3366"/><line style="stroke:#0000FF;stroke-width:1;" x1="272.3" x2="280.3" y1="240.3366" y2="240.3366"/><line style="stroke:#0000FF;stroke-width:1;" x1="276.3" x2="276.3" y1="241.3366" y2="233.3366"/><line style="stroke:#0000FF;stroke-width:1;" x1="276.3" x2="282.3" y1="298.4566" y2="306.4566"/><line style="stroke:#0000FF;stroke-width:1;" x1="276.3" x2="270.3" y1="298.4566" y2="306.4566"/><line style="stroke:#0000FF;stroke-width:1;" x1="276.3" x2="276.3" y1="298.4566" y2="306.4566"/><ellipse cx="276.3" cy="292.4566" fill="none" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254.1855" x="21.3" y="266.4649">groups points via uid (tenant/collection)</text></g><g class="legend" data-source-line="69"><rect fill="#DDDDDD" height="207.8594" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:1;" width="575.1062" x="638.3861" y="535.3642"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="82.2227" x="643.3861" y="553.8994">Cardinality:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="565.1062" x="643.3861" y="570.3877">&#8226; One qdr__collections row &#8596; many rows in qdrant_all_points sharing the same uid</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="643.3861" y="586.8759">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="84.5264" x="643.3861" y="603.3642">Data Types:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.1719" x="643.3861" y="619.8525">&#8226; Utf8 = String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="241.9102" x="643.3861" y="636.3408">&#8226; String (binary) = Binary byte array</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.1572" x="643.3861" y="652.8291">&#8226; JsonDocument = Arbitrary JSON structure</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="273.9297" x="643.3861" y="669.3173">&#8226; Timestamp = DateTime with timezone</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="643.3861" y="685.8056">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="59.5273" x="643.3861" y="702.2939">Sources:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="337.3057" x="643.3861" y="718.7822">&#8226; PlantUML ER: https://plantuml.com/er-diagram</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="417.6211" x="643.3861" y="735.2705">&#8226; YDB Types: https://ydb.tech/docs/en/yql/reference/types/</text></g><!--SRC=[ZLRRSjis47tdLspK5ya9JUVI6LTZUqOt9uuiMP7aXzw60v6GY344q00ecxOpqwT-GR-WdvOlwGAaH5fEE-M3BM8lsBDdBtmLqoKJ5EQTxkKWx7Pwmu_Jg-jn7tuO79z_E3_sNfKAa-4pwVdvu4FtHyzBM4mXOYhYrDCtJAH4aJLmj31vIa4gayYQ8E94QtZq09ykYMvMIcOYxaakrOiG2YMfOgeAXIv72tVQKKhURGypwdtrFCCCfp0G-3-7AUN4C2bqmbBeCxAoTozH- -T-r_yIAo8CpAZQi8Z-9fgJ9DSi8Xpwn10OoPXoyAqgpCc2KztoF5huRTp6AWmZoJcDdFy640srTpWv6L53Okl86P-TERG7DILemxLP7gFgP8XY209ed1WgCAYpuAJIEskWeU_Z7sCzXOAiwTPszw0nuNSarousT14IpiDKCc4mE2P02kexU-0abvb1TnlqBrKOipKLkWm8zT-_GrdCj24Ysbtqs9CQoNmQP15dyLDVcgSH4GangFMrykN8tfeikIJ62YD5YQ5nI0pAvdWT-bwdAC0gm42ZY6hzGkmmPMbiBJ5we2HAGAPKEKQXQH8b3N8TjopjDMBsmICpAouNP7k22V_etc5Il3ydA6FnFZEx56C9iWs6irHo3GLLyBfEQHEjpwLgEK_kkd3VtPPCkbxGE6PYXUAPKVP7Sy44KVaRM6QS-wcY4NEyk4IswZRXROPtimSQVyTwmOnVoMsvapHLyfwjCPUWAL5HOhsb94V7riDdBKLVHXaMWYsCGtmiWeDEPgIF7OkvnJZmalR1WJEiJhhvfVLn2eEnxTl-2_4CewZ4q7nxT3JgEixg_VBqvFloSO-eDZJiO4Wrb0SRHXm_pIBtGUMXrV0y8H6UOgl4W5pMkz5XcIZ4ht8OqXoG8in50QR6tkb_DA3pCRZ7miH9K5X- - -DlQE1O91atmJeFYnxGZQqeqrIzVVS-sB6cIqVp_UZ1zhG6egWLQo9OmPsHy2ln7uxydyBViSHZi13tWJxBcGlJfgWdnSOsXHH5iFRi58hoBDFtfeQzjOEuAyiPWY4hMc7TuMX3rvKQwABoB2r38ThjkIm4HKMUsxBTjwqgztzwwJApZMtcIjTDPWrD7CpXb_wqCvw7iq5dsliKZgxwWrOjtdiI6MYM3BNQW1DinQcV9aHJ68x783TKLQ6LPhLcQU_rKaH4pEn4qiK8-5u_lWP5VHn2DnRJYmjA78eHpXv8HO-zs6uYgdoDgxJzh_aCC1yLfjAonnboNLhYtF1rUGF6Kqo5P-dgNLuCRDOk-WDCtVIYStdnIsT-SJKEoovjrOgDqvLzSUNcekyHXM3GkychsA_mqs1_AG8kP_Zsvr-m9YAtBzekeXSJ6dH2N06O1AUJNMvOfTjKkLKynwrIwpatJ4_BiRVDtRCPs49nMLoB77k5A4NoKhC-wr2jev1YPJK_pwx6jXQpo6IAbjhLEZgrdmNKliCTCmaO_FM0MtL7ginKL0zpmX7dzUWI1jCs9CQakXq4gJtCrlmmaki0oOwBZvBIn7rhEB0xWpnU71eQ9K4i8nrG4UItF51qIHN5zHpOXQi3IrV1a_SF]--></g></svg>