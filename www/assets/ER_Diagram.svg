<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="856px" preserveAspectRatio="none" style="width:746px;height:856px;background:#FFFFFF;" version="1.1" viewBox="0 0 746 856" width="746px" zoomAndPan="magnify"><title>Entity Relationship Diagram for YDB-Qdrant Service
(Physical Data Model - YDB Tables)</title><defs/><g><g class="title" data-source-line="12"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="376.9063" x="177.6379" y="23.5352">Entity Relationship Diagram for YDB-Qdrant Service</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="255.3223" x="238.4299" y="40.0234">(Physical Data Model - YDB Tables)</text></g><!--class collections--><g class="entity" data-entity="collections" data-source-line="14" data-uid="ent0002" id="entity_collections"><rect fill="#E8F4F8" height="155.5508" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="322.4951" x="7" y="60.9766"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="101.7246" x="117.3853" y="77.5781">&#171;Metadata Table&#187;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.8945" x="113.3003" y="93.6445">qdr__collections</text><line style="stroke:#000000;stroke-width:0.5;" x1="8" x2="328.4951" y1="101.5977" y2="101.5977"/><ellipse cx="18" cy="115.3418" fill="#000000" rx="3" ry="3" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143.6094" x="27" y="119.1328">collection : Utf8 &#171;PK&#187;</text><line style="stroke:#000000;stroke-width:1;" x1="8" x2="328.4951" y1="126.0859" y2="126.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120.1416" x="13" y="143.6211">table_name : Utf8</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="178.3359" x="13" y="160.1094">vector_dimension : Uint32</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="310.4951" x="13" y="176.5977">distance : Utf8 {Cosine|Euclid|Dot|Manhattan}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.208" x="13" y="193.0859">vector_type : Utf8 {float|uint8}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.291" x="13" y="209.5742">created_at : Timestamp</text></g><!--class collection_table--><g class="entity" data-entity="collection_table" data-source-line="24" data-uid="ent0003" id="entity_collection_table"><rect fill="#E8F4F8" height="130.5742" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="268.6895" x="33.9" y="361.6866"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="185.6309" x="45.398" y="378.2881">&#171;Dynamic Per-Collection Table&#187;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.9902" x="83.2184" y="394.3545">qdr_&lt;tenant&gt;__</text><rect fill="#E8F4F8" height="16.1328" style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" width="58.0625" x="247.527" y="358.6866"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="56.0625" x="248.527" y="371.2881">collection</text><line style="stroke:#000000;stroke-width:0.5;" x1="34.9" x2="301.5895" y1="402.3077" y2="402.3077"/><ellipse cx="44.9" cy="416.0518" fill="#000000" rx="3" ry="3" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.4443" x="53.9" y="419.8428">point_id : Utf8 &#171;PK&#187;</text><line style="stroke:#000000;stroke-width:1;" x1="34.9" x2="301.5895" y1="426.7959" y2="426.7959"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185.6846" x="39.9" y="444.3311">embedding : String (binary)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164.8555" x="39.9" y="460.8194">payload : JsonDocument</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:1,2;" x1="34.9" x2="301.5895" y1="467.7725" y2="467.7725"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="256.6895" x="39.9" y="485.3077">INDEX: emb_idx (vector_kmeans_tree)</text></g><g class="entity" data-entity="GMN5" data-source-line="36" data-uid="ent0006" id="entity_GMN5"><path d="M364.66,64.8566 L364.66,134.4266 L329.81,138.4266 L364.66,142.4266 L364.66,212.6515 A0,0 0 0 0 364.66,212.6515 L623.8368,212.6515 A0,0 0 0 0 623.8368,212.6515 L623.8368,74.8566 L613.8368,64.8566 L364.66,64.8566 A0,0 0 0 0 364.66,64.8566" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M613.8368,64.8566 L613.8368,74.8566 L623.8368,74.8566 L613.8368,64.8566" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="135.2495" x="370.66" y="82.4249">Primary Key Format:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238.1768" x="370.66" y="97.7355">collection = "&lt;tenant&gt;/&lt;collection&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="370.66" y="113.046">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66.7583" x="370.66" y="128.3566">Examples:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.854" x="370.66" y="143.6671">&#8226; "default/my_vectors"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.5742" x="370.66" y="158.9777">&#8226; "user123/embeddings"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="370.66" y="174.2882">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.4131" x="370.66" y="189.5988">Tenant/collection names are</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.2739" x="370.66" y="204.9093">sanitized to [a-z0-9_]</text></g><g class="entity" data-entity="GMN8" data-source-line="48" data-uid="ent0009" id="entity_GMN8"><path d="M337.31,276.5266 L337.31,423.4266 L302.87,427.4266 L337.31,431.4266 L337.31,577.427 A0,0 0 0 0 337.31,577.427 L739.1821,577.427 A0,0 0 0 0 739.1821,577.427 L739.1821,286.5266 L729.1821,276.5266 L337.31,276.5266 A0,0 0 0 0 337.31,276.5266" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M729.1821,276.5266 L729.1821,286.5266 L739.1821,286.5266 L729.1821,276.5266" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="135.3828" x="343.31" y="294.0949">Naming Convention:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.0845" x="343.31" y="309.4055">Table name: qdr_&lt;tenant&gt;__&lt;collection&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="343.31" y="324.716">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66.7583" x="343.31" y="340.0266">Examples:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.5083" x="343.31" y="355.3371">&#8226; qdr_default__my_vectors</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.2285" x="343.31" y="370.6477">&#8226; qdr_user123__embeddings</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="343.31" y="385.9582">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="157.1362" x="343.31" y="401.2688">Vector Index (emb_idx):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275.5645" x="343.31" y="416.5793">&#8226; Type: vector_kmeans_tree (GLOBAL SYNC)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211.7007" x="343.31" y="431.8898">&#8226; Auto-created after &#8805;100 points</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.1753" x="343.31" y="447.2004">&#8226; Defaults: levels=1, clusters=128</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.9097" x="343.31" y="462.5109">&#8226; Build trigger: 5s quiet window</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="343.31" y="477.8215">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="133.4531" x="343.31" y="493.132">Embedding Storage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="308.0835" x="343.31" y="508.4426">Binary string via Knn::ToBinaryString{Float|Uint8}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="343.31" y="523.7531">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="47.2646" x="343.31" y="539.0637">Search:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380.8721" x="343.31" y="554.3742">&#8226; With index: SELECT ... VIEW emb_idx ORDER BY Knn::&lt;Fn&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221.0381" x="343.31" y="569.6848">&#8226; Fallback: table scan without VIEW</text></g><!--link collections to collection_table--><g class="link" data-entity-1="collections" data-entity-2="collection_table" data-source-line="33" data-uid="lnk4" id="link_collections_collection_table"><path codeLine="33" d="M168.25,224.7466 C168.25,270.0966 168.25,310.5966 168.25,353.5966" fill="none" id="collections-collection_table" style="stroke:#0000FF;stroke-width:1;"/><line style="stroke:#0000FF;stroke-width:1;" x1="164.25" x2="172.25" y1="220.7466" y2="220.7466"/><line style="stroke:#0000FF;stroke-width:1;" x1="164.25" x2="172.25" y1="223.7466" y2="223.7466"/><line style="stroke:#0000FF;stroke-width:1;" x1="168.25" x2="168.25" y1="224.7466" y2="216.7466"/><line style="stroke:#0000FF;stroke-width:1;" x1="172.25" x2="164.25" y1="357.5966" y2="357.5966"/><line style="stroke:#0000FF;stroke-width:1;" x1="172.25" x2="164.25" y1="354.5966" y2="354.5966"/><line style="stroke:#0000FF;stroke-width:1;" x1="168.25" x2="168.25" y1="353.5966" y2="361.5966"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65.7427" x="87.4434" y="270.7449">references</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.1294" x="73.25" y="286.0555">via table_name</text></g><g class="legend" data-source-line="69"><rect fill="#DDDDDD" height="240.8359" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:1;" width="427.6211" x="292.561" y="595.427"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="82.2227" x="297.561" y="613.9621">Cardinality:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="341.626" x="297.561" y="630.4504">&#8226; One qdr__collections row &#8594; One collection table</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="321.6719" x="297.561" y="646.9387">&#8226; Dynamic tables created on collection creation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="244.8359" x="297.561" y="663.427">&#8226; Deleted when collection is deleted</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="297.561" y="679.9152">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="84.5264" x="297.561" y="696.4035">Data Types:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.1719" x="297.561" y="712.8918">&#8226; Utf8 = String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="241.9102" x="297.561" y="729.3801">&#8226; String (binary) = Binary byte array</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.1572" x="297.561" y="745.8684">&#8226; JsonDocument = Arbitrary JSON structure</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="273.9297" x="297.561" y="762.3566">&#8226; Timestamp = DateTime with timezone</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="297.561" y="778.8449">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="59.5273" x="297.561" y="795.3332">Sources:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="337.3057" x="297.561" y="811.8215">&#8226; PlantUML ER: https://plantuml.com/er-diagram</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="417.6211" x="297.561" y="828.3098">&#8226; YDB Types: https://ydb.tech/docs/en/yql/reference/types/</text></g><!--SRC=[TLNRJkD847ttLzHaNm1DCCn5OYs8bEk8uPQ5CBDePsLrx4hIejCTkjimXeoqJoljwtx2IljZVCbMj-t4mC93iBjELTSvTV6R52TS8epQdUD-t6btZpwTdrsUzk2d_jxWms0lU5C2XaTFh8D1_qFdOn3CU8gGS9q83CmrbmkcsHm4UTXyWQ2qdQcQ8H7C67W8WFuwBBcUQfN9jAk4qYzIA41AfwWBG4UGXpzjQwtkgiCCWnz1OBaL27r9_tCuHy4iLzBC-09wd4tTtHD2N_KwpLzIpQI52zItFC5lScCuomrFc80UimnEL8e2cWuA8pOMQ3Q308kuZPjKnt6YXC34nsy0Cr1xX_tz4xGiTO6ySwlbsMxLG131fPti4NHur6gHiTca7-lGiMHpBErqTaiEIiSfdwCqfIUNzlqxigNSM2QJ2WqFNML8zMK_ImHFbprbboTCpfWbr8zrB5-LocKY5BFBZ4BkEKYYaLbCOsO9CQ9BwORvmebRfxzlKP9-hJZUNtDgFHCYzdI8OYydIZo18UfcTot1KsqMYbA8UVh_ok1yZ6dAvPJC5rQxXuqnbqpdcsHTi9nOEDVFHicUIZ8Iov9XUvj-3azx_LyZ5uB2VuUDKeNhEJ9fOgiHDns_UWMNosPpkNp99OA6nWbg9D7DDtdBMQrcZI2GoY9eFfrPK9DwJpYAMqFDvvGn764E0wNdp4PRMqxpjIO7qAYq3Pz8Ip0Ve_-Toa7zM7W-_l4FD6WuMIPiEC_ZWfffLARCeDvzzpvSoMVAG2D_HrYxsJ4mm3Gwis6IMtwFALW5lx7c_Kxpv_XtQe4K7CNNYHOw-KnFgUPKfgwIjwvrb2nIzbNtjqNmUYkzJjVvb8pZU4svPYr9n_6QTHNkYmV3eKoH6g7iYCrry15DHWGl6mGsFXsVTTh7S75rsjqimUtCgcOvBy0c5ZKy_lNlxivEqSjLIhqYMHE1m5iKvc3tBQt0p12Udj_jbR1EnWN9JPfEKKVmqS1Dnj727PUfkblfiPg32qgHJR78lUD70Kmn6QujZwICef4g3CN4F0pyg5zMe-u3NY3JoMojm5TkPy2TFZHe_UD-TqH3j0rV3ljVLnDqTjxhdqFdghXaV-3BvPm7J8WnxUUec0em2PD4WDP_Pds8MWS9dBeNtqC-aoxJH8m9MZBhTCxeg_DytmBjVNZyyszlh7LmrNfUz7Bb-3DJRJKWLCt1dzB3gb027UXkXazWt41Qc2hH_3V2zKgjB_tIEYYNKtdsR5EHkIpKEAVnOLgpl4JMznR1sdhChNR8pnTdfwwkMM8pNR5RxMM2KYxethtEOEdfNabSbLTbEgcdEHGqR9Sdnz0_Zs1cxS94ORXmXzbSR2Tg7jAIJeklPUdYFuAUxCeXJyVR5fDPcAh4X2Z3_4Q4gyqOkW-C2LsnYoe7_m40]--></g></svg>